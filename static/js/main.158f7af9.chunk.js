(this.webpackJsonpelectricad=this.webpackJsonpelectricad||[]).push([[0],{33:function(e,t,n){e.exports=n(44)},38:function(e,t,n){},39:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),c=n(4),a=n.n(c),i=(n(38),n(3)),u=n(5),s=Object(o.createContext)(null);function l(e){var t=e.width,n=e.height,c=Object(o.useContext)(s),a=c.__selectedRoom,l=c.__rooms,d=Object(i.a)(l,2),f=d[0],p=d[1],b=Object(i.a)(a,2),O=(b[0],b[1]);return r.a.createElement("rect",{id:"background",width:t,height:n,fill:"#38a0f9",onDoubleClick:function(e){var t=window.prompt("D\xe9nomination de la pi\xe8ce");if(""!==t&&null!==t)if(f.find((function(e){return e.id===t})))alert("Une pi\xe8ce nomm\xe9e ".concat(t," existe d\xe9j\xe0. Cr\xe9ation annul\xe9e !!!"));else{var n={id:t,coords:[e.clientX-75,e.clientY-75],points:[[0,0],[0,150],[150,150],[150,0]],getPoints:function(){var e=this;return this.points.reduce((function(t,n,o){return t[o]={x:n[0],y:n[1],absX:n[0]+e.coords[0],absY:n[1]+e.coords[1],offsetX:e.coords[0],offsetY:e.coords[1],i:o},t}),[])}};p([].concat(Object(u.a)(f),[n])),O(n.id)}},onClick:function(){return O(null)}})}var d=n(11),f=n(17);function p(e){return e.map((function(e){return[e[0],e[1]].join(" ")}))}function b(e){return e.reduce((function(t,n,o){return t[o]=[{XY:n,i:o}],o>0&&t[o-1].push({XY:n,i:o}),o===e.length-1&&t[o].push(t[0][0]),t}),[])}function O(e,t){return e.filter((function(e,n){return n!==t})).reduce((function(e,t,n){return t.points.map((function(n){n.dx=t.coords[0],n.dy=t.coords[1],e.push(n)})),e}),[])}function m(e){return e.points.map((function(t){return t.dx=e.coords[0],t.dy=e.coords[1],t}))}function h(e){return e.reduce((function(e,t,n){var o=m(t);return e.push.apply(e,Object(u.a)(o)),e}),[])}function j(e){e.forEach((function(t,n){var o=O(e,n);b(t.points).forEach((function(e){o.forEach((function(t){console.log(t),function(e,t){var n=Object(i.a)(e,2),o=n[0],r=n[1];console.log(o);var c,a=o.XY[0]+o.XY.dx,u=o.XY[1]+o.XY.dy,s=r.XY[0]+r.XY.dx,l=r.XY[1]+r.XY.dy,d=s-a,f=l-u,p=f/d,b=u-p*a;0===d?(console.log("droite verticale"),c=a-(t[0]+t.dx)):c=0===f?u-(t[1]+t.dy):u-p*a-b;console.log(c),console.log(t[1]+t.dx-p*(t[0]+t.dy)-b),t[1]+t.dx-p*(t[0]+t.dy)-b===c&&console.log("coucou petite peruche")}(e,t)}))}))}))}function v(e){var t=e.polygon;return r.a.createElement("polygon",{points:t,fill:"#ffffaa",stroke:"steelblue"})}var y=function(e){var t=e.coords,n=e.point,c=e.pointIndex,a=e.points,l=e.setPoints,d=e.visible,p=Object(o.useContext)(s).__rooms,b=Object(i.a)(p,2),O=b[0];if(b[1],!d)return null;var m=n[0],j=n[1];return r.a.createElement(f.DraggableCore,{handle:".corner",onDrag:function(e,t){var n=Object(u.a)(a);n[c]=[m+t.deltaX,j+t.deltaY],l(n)},onStop:function(){var e=Object(u.a)(a);h(O).map((function(o){o!==n&&(Math.abs(n[0]+t[0]-(o[0]+o.dx))<10&&(e[c][0]=o[0]+o.dx-t[0]),Math.abs(n[1]+t[1]-(o[1]+o.dy))<10&&(console.log("match"),e[c][1]=o[1]+o.dy-t[1]))})),l(e)}},r.a.createElement("g",null,r.a.createElement("circle",{className:"corner",cx:m,cy:j,r:16,fill:"white",stroke:"#38a0f9",strokeWidth:4}),r.a.createElement("text",{x:m,y:j,textAnchor:"middle",alignmentBaseline:"central",pointerEvents:"none",fill:"grey"},2)))},g=n(30);function x(e){var t=e.pathPoints,n=e.visible,c=(e.segmentIndex,e.setPoints),a=e.points,l=Object(o.useContext)(s),d=l.__quickMenuPosition,p=l.__quickMenuState,b=l.__selectedPathPoints,O=l.__rooms,m=Object(i.a)(d,2),j=(m[0],m[1]),v=Object(i.a)(p,2),y=(v[0],v[1]),x=Object(i.a)(b,2),X=(x[0],x[1]),Y=Object(i.a)(O,2),_=Y[0],P=(Y[1],Object(o.useState)(!1)),E=Object(i.a)(P,2),w=E[0],k=E[1],C=Object(i.a)(t,2),D=C[0],M=C[1],S=[D.XY,M.XY],I=Object(i.a)(D.XY,2),q=I[0],R=I[1],B=Object(i.a)(M.XY,2),W=B[0],N=B[1],A=Object(g.a)().x((function(e){return e[0]})).y((function(e){return e[1]})),H=function(e){var n,o;console.log(e.type),e.preventDefault(),"mouseup"===e.type?(n=e.clientX,o=e.clientY):(n=e.touches[0].pageX,o=e.touches[0].pageY),j({x:n,y:o}),y((function(e){return!e})),X(t)};return n?r.a.createElement(f.DraggableCore,{handle:".segment",onDrag:function(e,n){k(!0);var o=Object(u.a)(t);o[0]=[q+n.deltaX,R+n.deltaY],o[1]=[W+n.deltaX,N+n.deltaY];var r=Object(u.a)(a);r[D.i]=o[0],r[M.i]=o[1],c(Object(u.a)(r))},onStop:function(e,t){if(w){k(!1);var n=h(_),o=Object(u.a)(a);n.map((function(e){Math.abs(e[0]+e.dx-(q+D.XY.dx))<=16&&(o[D.i][0]=e.dx+e[0]-D.XY.dx),Math.abs(e[1]+e.dy-(R+D.XY.dy))<=16&&(o[D.i][1]=e.dy+e[1]-D.XY.dy),Math.abs(e[0]+e.dx-(W+M.XY.dx))<=16&&(o[M.i][0]=e.dx+e[0]-M.XY.dx),Math.abs(e[1]+e.dy-(N+M.XY.dy))<=16&&(o[M.i][1]=e.dy+e[1]-M.XY.dy),c(Object(u.a)(o))}))}else H(e)}},r.a.createElement("path",{d:A(S),id:D.i+"."+M.i,className:"segment",strokeWidth:20,stroke:"#77cfff",opacity:.8,onClick:function(e){return H(e)}})):null}var X=function(e){var t=e.pathPoints,n=e.visible,o=Object(i.a)(t,2),c=o[0],a=o[1],u=Object(i.a)(c.XY,2),s=u[0],l=u[1],d=Object(i.a)(a.XY,2),f=s-d[0],p=l-d[1],b=Math.round(5*Math.floor(Math.sqrt(f*f+p*p)/5));return n?r.a.createElement("text",{style:{pointerEvents:"none",fill:"#404040"}},r.a.createElement("textPath",{startOffset:"45%",xlinkHref:"#"+c.i+"."+a.i},b)):null};function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=function(e){var t=e.isSelected,n=e.roomIndex,c=e.id,a=e.coords,l=e.room,d=e.points,h=Object(o.useContext)(s),g=h.__rooms,Y=h.__selectedRoom,P=Object(i.a)(g,2),E=P[0],w=P[1],k=Object(i.a)(Y,2),C=(k[0],k[1]),D=Object(o.useState)(d),M=Object(i.a)(D,2),S=M[0],I=M[1];Object(o.useEffect)((function(){q(l,n)}),[S]);var q=function(e,t){w((function(n){return[].concat(Object(u.a)(n.slice(0,t)),[_({},e,{points:S})],Object(u.a)(n.slice(t+1)))}))};return r.a.createElement(f.DraggableCore,{handle:".room",cancel:".corner, .segment",disabled:!t,onStop:function(e,t){var o=m(l),r=O(E,n),c=o.map((function(e){return r.map((function(t){var n=e[0]+e.dx,o=t[0]+t.dx;Math.abs(n-o)<=10&&(e[0]=o-e.dx)})),r.map((function(t){var n=e[1]+e.dy,o=t[1]+t.dy;Math.abs(n-o)<=10&&(e[1]=o-e.dy)})),e})),a=_({},l,{points:c});q(a,n),j(E)},onDrag:function(e,t){e.preventDefault(),a[0]+=t.deltaX,a[1]+=t.deltaY,q(l,n)}},r.a.createElement("g",{className:"room",id:c,transform:"translate(".concat(a[0]," ").concat(a[1],")"),onClick:function(){C(c)},onKeyDown:function(e){t&&8===e.keyCode&&w((function(e){return e.filter((function(e){return e.id!==c}))}))},tabIndex:-1,style:{outline:0}},r.a.createElement(v,{polygon:p(S)}),b(S).map((function(e,n){return r.a.createElement(x,{key:n,pathPoints:e,visible:t,segmentIndex:n,setPoints:I,points:S})})),S.map((function(e,n){return r.a.createElement(y,{coords:a,key:n,point:e,pointIndex:n,points:S,setPoints:I,visible:t})})),b(S).map((function(e,n){return r.a.createElement(X,{key:n,pathPoints:e,visible:t})}))))};function E(){var e=Object(o.useContext)(s),t=e.__rooms,n=e.__selectedRoom,c=e.__selectedPathPoints,a=Object(i.a)(t,2),u=a[0],d=(a[1],Object(i.a)(n,2)),f=d[0],p=(d[1],Object(i.a)(c,2)),b=(p[0],p[1],window.innerWidth),O=window.innerHeight;return r.a.createElement("svg",{width:b,height:O},r.a.createElement(l,{width:b,height:O}),u.sort((function(e,t){var n=e.id===f;return n===(t.id===f)?0:n?1:-1})).map((function(e,t){return r.a.createElement(P,{key:e.id,roomIndex:t,id:e.id,coords:e.coords,isSelected:f===e.id,room:e,points:e.points})})))}n(39);var w=n(66),k=n(67);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var D=function(){var e=Object(o.useContext)(s),t=e.__quickMenuPosition,n=e.__quickMenuState,c=e.__selectedPathPoints,a=e.__rooms,l=e.__selectedRoom,f=Object(i.a)(t,2),p=f[0],b=f[1],O=Object(i.a)(n,2),m=O[0],h=O[1],j=Object(i.a)(c,2),v=j[0],y=(j[1],Object(i.a)(a,2)),g=y[0],x=y[1],X=Object(i.a)(l,2),Y=X[0],_=(X[1],function(e){h(!1),b(null)});return r.a.createElement(w.a,{id:"quickMenu",transitionDuration:{enter:0,exit:0},anchorReference:"anchorPosition",anchorPosition:null!==p?{top:p.y,left:p.x}:void 0,open:m,onClose:_},r.a.createElement(k.a,{onClick:function(e){var t,n=function(e,t){e.persist();var n=e.target.getBoundingClientRect(),o=[e.clientX,e.clientY],r=[];r[0]=t[0].XY[0]<t[1].XY[0]?o[0]-n.left+t[0].XY[0]:o[0]-n.left+t[1].XY[0];var c=t[0],a=t[1],i=c.XY[0]-a.XY[0],u=(c.XY[1]-a.XY[1])/i,s=c.XY[1]-u*c.XY[0];return 0===u?r[1]=c.XY[1]:u===1/0||u===-1/0?(r[0]=c.XY[0],r[1]=c.XY[1]<a.XY[1]?Math.abs(o[1]-n.top+c.XY[1]):Math.abs(o[1]-n.top+a.XY[1])):r[1]=u*r[0]+s,c.i,a.i,console.log([r,r]),[r,r]}(e,v),o=v[0].i,r=(v[1].i,Object(u.a)(g)),c=r.findIndex((function(e){return e.id===Y}));r[c]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r[c],{points:(t=r[c].points).splice.apply(t,[o+1,0].concat(Object(u.a)(n)))}),x(r),_()}},"new corner"),r.a.createElement(k.a,{onClick:function(e){console.log("selectedPathPoints",v),_()}},"new door"))};var M=function(){var e=Object(o.useState)(null),t=Object(o.useState)(!1),n=Object(o.useState)([]),c={__quickMenuPosition:e,__quickMenuState:t,__selectedRoom:Object(o.useState)(null),__rooms:n,__selectedPathPoints:Object(o.useState)(null)};return r.a.createElement("div",{className:"App",style:{overscrollBehavior:"none"},onContextMenu:function(e){return e.preventDefault()}},r.a.createElement(s.Provider,{value:c},r.a.createElement(E,null),r.a.createElement(D,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[33,1,2]]]);
//# sourceMappingURL=main.158f7af9.chunk.js.map