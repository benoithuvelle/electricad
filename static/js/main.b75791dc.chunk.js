(this.webpackJsonpelectricad=this.webpackJsonpelectricad||[]).push([[0],{13:function(e,t,n){},14:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),a=n(4),c=n.n(a),i=(n(13),n(2)),l=n(1);function s(e){var t=e.setSelectedRoom,n=e.setRooms,o=e.rooms,a=e.width,c=e.height;return r.a.createElement("rect",{id:"background",width:a,height:c,fill:"#38a0f9",onDoubleClick:function(e){var r=window.prompt("D\xe9nomination de la pi\xe8ce");if(o.find((function(e){return e.id===r})))alert("Une pi\xe8ce nomm\xe9e ".concat(r," existe d\xe9j\xe0. Cr\xe9ation annul\xe9e !!!"));else{var a={id:r,coords:[e.clientX-75,e.clientY-75],points:[[0,0],[0,150],[150,150],[150,0]]};n([].concat(Object(l.a)(o),[a])),t(a.id)}},onClick:function(){return t(null)}})}var u=n(6),d=n(3);function f(e){return e.map((function(e){return[e[0],e[1]].join(" ")}))}function m(e){return e.reduce((function(t,n,o){return t[o]=[{XY:n,i:o}],o>0&&t[o-1].push({XY:n,i:o}),o===e.length-1&&t[o].push(t[0][0]),t}),[])}function p(e){return e.points.map((function(t){return t.dx=e.coords[0],t.dy=e.coords[1],t}))}function b(e){return e.reduce((function(e,t,n){var o=p(t);return e.push.apply(e,Object(l.a)(o)),e}),[])}function h(e){var t=e.polygon;return r.a.createElement("polygon",{points:t,fill:"#ffffaa",stroke:"steelblue"})}var g=function(e){var t=e.coords,n=e.point,o=e.pointIndex,a=e.points,c=e.setPoints,i=e.visible,s=e.rooms;if(!i)return null;var u=n[0],f=n[1];return r.a.createElement(d.DraggableCore,{handle:".corner",onDrag:function(e,t){var n=Object(l.a)(a);n[o]=[u+t.deltaX,f+t.deltaY],c(n)},onStop:function(){var e=Object(l.a)(a);b(s).map((function(r){r!==n&&(Math.abs(n[0]+t[0]-(r[0]+r.dx))<10&&(e[o][0]=r[0]+r.dx-t[0]),Math.abs(n[1]+t[1]-(r[1]+r.dy))<10&&(console.log("match"),e[o][1]=r[1]+r.dy-t[1]))})),c(e)}},r.a.createElement("g",null,r.a.createElement("circle",{className:"corner",cx:u,cy:f,r:16,fill:"white",stroke:"#38a0f9",strokeWidth:4}),r.a.createElement("text",{x:u,y:f,textAnchor:"middle",alignmentBaseline:"central",pointerEvents:"none",fill:"grey"},2)))},v=n(7);function y(e){var t=e.pathPoints,n=e.visible,o=(e.segmentIndex,e.setPoints),a=e.points,c=e.rooms;console.log(t);var s=Object(i.a)(t,2),u=s[0],f=s[1],m=[u.XY,f.XY],p=Object(i.a)(u.XY,2),h=p[0],g=p[1],y=Object(i.a)(f.XY,2),O=y[0],j=y[1],X=Object(v.a)().x((function(e){return e[0]})).y((function(e){return e[1]}));return n?r.a.createElement(d.DraggableCore,{handle:".segment",onDrag:function(e,n){var r=Object(l.a)(t);r[0]=[h+n.deltaX,g+n.deltaY],r[1]=[O+n.deltaX,j+n.deltaY];var c=Object(l.a)(a);c[u.i]=r[0],c[f.i]=r[1],o(Object(l.a)(c))},onStop:function(e,t){var n=b(c),r=Object(l.a)(a);console.log(r),n.map((function(e){Math.abs(e[0]+e.dx-(h+u.XY.dx))<=16&&(r[u.i][0]=e.dx+e[0]-u.XY.dx,console.log("match")),Math.abs(e[1]+e.dy-(g+u.XY.dy))<=16&&(r[u.i][1]=e.dy+e[1]-u.XY.dy,console.log("match")),Math.abs(e[0]+e.dx-(O+f.XY.dx))<=16&&(r[f.i][0]=e.dx+e[0]-f.XY.dx,console.log("match")),Math.abs(e[1]+e.dy-(j+f.XY.dy))<=16&&(r[f.i][1]=e.dy+e[1]-f.XY.dy,console.log("match")),o(Object(l.a)(r))}))}},r.a.createElement("path",{d:X(m),id:u.i+"."+f.i,className:"segment",strokeWidth:20,stroke:"#77cfff",opacity:.8,onDoubleClick:function(e){e.persist();var n=e.target.getBoundingClientRect(),r=[e.clientX,e.clientY],c=[];c[0]=t[0].XY[0]<t[1].XY[0]?r[0]-n.left+t[0].XY[0]:r[0]-n.left+t[1].XY[0];var i=t[0],s=t[1],u=i.XY[0]-s.XY[0],d=(i.XY[1]-s.XY[1])/u,f=i.XY[1]-d*i.XY[0];0===d?c[1]=i.XY[1]:d===1/0||d===-1/0?(c[0]=i.XY[0],c[1]=i.XY[1]<s.XY[1]?Math.abs(r[1]-n.top+i.XY[1]):Math.abs(r[1]-n.top+s.XY[1])):c[1]=d*c[0]+f;var m=i.i;s.i;a.splice(m+1,0,c),o(Object(l.a)(a)),console.log(a)}})):null}var O=function(e){var t=e.pathPoints,n=e.visible,o=Object(i.a)(t,2),a=o[0],c=o[1],l=Object(i.a)(a.XY,2),s=l[0],u=l[1],d=Object(i.a)(c.XY,2),f=s-d[0],m=u-d[1],p=Math.round(5*Math.floor(Math.sqrt(f*f+m*m)/5));return n?r.a.createElement("text",null,r.a.createElement("textPath",{startOffset:"45%",xlinkHref:"#"+a.i+"."+c.i},p)):null};function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=function(e){var t=e.setRooms,n=e.setSelectedRoom,a=e.isSelected,c=e.roomIndex,s=e.id,u=e.coords,b=e.room,v=e.rooms,j=e.points,Y=Object(o.useState)(j),x=Object(i.a)(Y,2),E=x[0],w=x[1];Object(o.useEffect)((function(){k(b,c)}),[E]);var k=function(e,n){t((function(t){return[].concat(Object(l.a)(t.slice(0,n)),[X({},e,{points:E})],Object(l.a)(t.slice(n+1)))}))};return r.a.createElement(d.DraggableCore,{handle:".room",cancel:".corner, .segment",disabled:!a,onStop:function(e,t){var n=p(b),o=function(e,t){return e.filter((function(e,n){return n!==t})).reduce((function(e,t,n){return t.points.map((function(n){n.dx=t.coords[0],n.dy=t.coords[1],e.push(n)})),e}),[])}(v,c),r=n.map((function(e){return o.map((function(t){var n=e[0]+e.dx,o=t[0]+t.dx;Math.abs(n-o)<=10&&(e[0]=o-e.dx)})),o.map((function(t){var n=e[1]+e.dy,o=t[1]+t.dy;Math.abs(n-o)<=10&&(e[1]=o-e.dy)})),e})),a=X({},b,{points:r});k(a,c)},onDrag:function(e,t){e.preventDefault(),u[0]+=t.deltaX,u[1]+=t.deltaY,k(b,c)}},r.a.createElement("g",{className:"room",id:s,transform:"translate(".concat(u[0]," ").concat(u[1],")"),onClick:function(){n(s)},onKeyDown:function(e){a&&8===e.keyCode&&t((function(e){return e.filter((function(e){return e.id!==s}))}))},tabIndex:-1,style:{outline:0}},r.a.createElement(h,{polygon:f(E)}),m(E).map((function(e,t){return r.a.createElement(y,{key:t,pathPoints:e,visible:a,segmentIndex:t,setPoints:w,points:E,rooms:v})})),E.map((function(e,t){return r.a.createElement(g,{coords:u,key:t,point:e,pointIndex:t,points:E,setPoints:w,visible:a,rooms:v})})),m(E).map((function(e,t){return r.a.createElement(O,{key:t,pathPoints:e,visible:a})}))))};function x(){var e=Object(o.useState)([]),t=Object(i.a)(e,2),n=t[0],a=t[1],c=Object(o.useState)(null),l=Object(i.a)(c,2),u=l[0],d=l[1],f=window.innerWidth,m=window.innerHeight;return r.a.createElement("svg",{width:f,height:m},r.a.createElement(s,{width:f,height:m,setSelectedRoom:d,setRooms:a,rooms:n}),n.sort((function(e,t){var n=e.id===u;return n===(t.id===u)?0:n?1:-1})).map((function(e,t){return r.a.createElement(Y,{key:e.id,roomIndex:t,id:e.id,coords:e.coords,isSelected:u===e.id,setSelectedRoom:d,rooms:n,setRooms:a,room:e,points:e.points})})))}n(14);var E=function(){return console.log("app rendering"),r.a.createElement("div",{className:"App",style:{overscrollBehavior:"none"}},r.a.createElement(x,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},8:function(e,t,n){e.exports=n(15)}},[[8,1,2]]]);
//# sourceMappingURL=main.b75791dc.chunk.js.map