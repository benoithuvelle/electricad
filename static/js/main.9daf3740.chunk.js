(this.webpackJsonpelectricad=this.webpackJsonpelectricad||[]).push([[0],{33:function(e,t,n){e.exports=n(44)},38:function(e,t,n){},39:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(4),r=n.n(i),c=(n(38),n(3)),s=n(7),l=Object(o.createContext)(null);function u(e){var t=e.width,n=e.height,i=Object(o.useContext)(l),r=i.__selectedRoom,u=i.__rooms,f=Object(c.a)(u,2),b=f[0],d=f[1],p=Object(c.a)(r,2),m=(p[0],p[1]),y=function(e){var o=window.prompt("D\xe9nomination de la pi\xe8ce");if(""!==o&&null!==o)if(b.find((function(e){return e.id===o})))alert("Une pi\xe8ce nomm\xe9e ".concat(o," existe d\xe9j\xe0. Cr\xe9ation annul\xe9e !!!"));else{var a={id:o,x:e.clientX?e.clientX-75:t/2,y:e.clientY?e.clientY-75:n/2,points:[{x:0,y:0},{x:0,y:150},{x:150,y:150},{x:150,y:0}],getPoints:function(){var e=this;return this.points.reduce((function(t,n,a){return t[a]={x:n.x,y:n.y,absX:n.x+e.x,absY:n.y+e.y,offsetX:e.x,offsetY:e.y,i:a,room:o,id:"".concat(e.id,".").concat(a)},t}),[])},doors:[]};d([].concat(Object(s.a)(b),[a])),m(a.id)}};return a.a.createElement("rect",{style:{outline:"none"},tabIndex:-1,id:"background",width:t,height:n,fill:"#38a0f9",onDoubleClick:y,onClick:function(){return m(null)},onKeyDown:function(e){78===e.keyCode&&y(e)}})}var f=n(17);function b(e){return e.reduce((function(t,n,o){return t[o]=[n],o>0&&t[o-1].push(n),o===e.length-1&&t[o].push(t[0][0]),t}),[])}function d(e){return e.reduce((function(e,t,n){var o=t.getPoints();return e.push.apply(e,Object(s.a)(o)),e}),[])}function p(e){var t=e.polygon;return a.a.createElement("polygon",{points:t,fill:"#ffffaa",stroke:"steelblue"})}var m=function(e){var t=e.point,n=e.visible,i=Object(o.useContext)(l).__rooms,r=Object(c.a)(i,2),u=r[0],b=r[1],p=u.findIndex((function(e){return e.id===t.room}));return n?a.a.createElement(f.DraggableCore,{handle:".corner",onDrag:function(e,n){u[p].points[t.i].x=t.x+n.deltaX,u[p].points[t.i].y=t.y+n.deltaY,b(Object(s.a)(u))},onStop:function(){var e=d(u);console.log(e),e.map((function(e){console.log(e.i),console.log(e.room),e.room===t.room&&e.i===t.i||(Math.abs(t.absX-e.absX)<16&&(u[p].points[t.i].x=e.absX-t.offsetX),Math.abs(t.absY-e.absY)<16&&(u[p].points[t.i].y=e.absY-t.offsetY))})),b(Object(s.a)(u))}},a.a.createElement("g",null,a.a.createElement("circle",{className:"corner",cx:t.x,cy:t.y,r:16,fill:"white",stroke:"#38a0f9",strokeWidth:4}),a.a.createElement("text",{x:t.x,y:t.y,textAnchor:"middle",alignmentBaseline:"central",pointerEvents:"none",fill:"grey"},t.i))):null},y=n(30);function x(e){var t=e.pathPoints,n=e.visible,i=(e.segmentIndex,Object(o.useContext)(l)),r=i.__quickMenuPosition,u=i.__quickMenuState,b=i.__selectedPathPoints,p=i.__rooms,m=i.__pointer,x=i.__pathNode,O=Object(c.a)(r,2),h=(O[0],O[1]),j=Object(c.a)(u,2),g=(j[0],j[1]),v=Object(c.a)(b,2),_=(v[0],v[1]),E=Object(c.a)(p,2),P=E[0],k=E[1],w=Object(c.a)(m,2),X=(w[0],w[1]),Y=Object(c.a)(x,2),C=(Y[0],Y[1]),M=Object(o.useState)(!1),S=Object(c.a)(M,2),D=S[0],I=S[1],q=Object(c.a)(t,2),N=q[0],R=q[1],W=P.findIndex((function(e){return e.id===N.room})),B=[[N.x,N.y],[R.x,R.y]],F=Object(y.a)().x((function(e){return e[0]})).y((function(e){return e[1]})),A=function(e){var n,o;X({x:e.clientX,y:e.clientY}),e.preventDefault(),"mouseup"===e.type?(n=e.clientX,o=e.clientY):(n=e.touches[0].pageX,o=e.touches[0].pageY),h({x:n,y:o}),g((function(e){return!e})),_(t),C(e.target)};return a.a.createElement(f.DraggableCore,{handle:".segment",onDrag:function(e,t){I(!0),N.x+=t.deltaX,N.y+=t.deltaY,R.x+=t.deltaX,R.y+=t.deltaY,P[W].points[N.i].x=N.x,P[W].points[N.i].y=N.y,P[W].points[R.i].x=R.x,P[W].points[R.i].y=R.y,k(Object(s.a)(P))},onStop:function(e,n){if(D){I(!1);var o=d(P);t.forEach((function(e){o.forEach((function(t){e.id!==t.id&&(Math.abs(e.absX-t.absX)<=16&&(P[W].points[e.i].x=t.absX-e.offsetX),Math.abs(e.absY-t.absY)<=16&&(P[W].points[e.i].y=t.absY-e.offsetY))}))})),k(Object(s.a)(P))}else A(e)}},a.a.createElement("path",{style:n?{visibility:"visible"}:{visibility:"hidden"},d:F(B),id:N.room+"."+N.i+"."+R.i,className:"segment",strokeWidth:20,stroke:"#77cfff",opacity:.8}))}var O=function(e){var t=e.pathPoints,n=e.visible,o=Object(c.a)(t,2),i=o[0],r=o[1],s=i.x-r.x,l=i.y-r.y,u=Math.round(5*Math.floor(Math.sqrt(s*s+l*l)/5));return n?a.a.createElement("text",{style:{pointerEvents:"none",fill:"#404040"}},a.a.createElement("textPath",{startOffset:"45%",xlinkHref:"#"+i.i+"."+r.i},u)):null};function h(e){var t=e.door,n=Object(o.useContext)(l).__rooms,i=Object(c.a)(n,1)[0],r=t.pointsIds;t.XFromOrigin;console.log(r.a);var s=r.a.split(".")[0];console.log(s);var u=i.findIndex((function(e){return e.id===s})),f=i[u].getPoints().findIndex((function(e){return e.id===r.a})),b=i[u].getPoints().findIndex((function(e){return e.id===r.b})),d=i[u].points[f],p=i[u].points[b];return console.log(d),console.log(p),a.a.createElement("circle",{cx:(d.x+p.x)/2,cy:(d.y+p.y)/2,r:10,fill:"pink"})}var j=function(e){var t,n=e.isSelected,i=e.room,r=e.i,u=Object(o.useContext)(l),y=u.__rooms,j=u.__selectedRoom,g=Object(c.a)(y,2),v=g[0],_=g[1],E=Object(c.a)(j,2),P=(E[0],E[1]);return a.a.createElement(f.DraggableCore,{handle:".room",cancel:".corner, .segment",disabled:!n,onStop:function(e,t){var n=d(v);i.getPoints().forEach((function(e){n.forEach((function(t){var n=Math.abs(e.absX-t.absX),o=Math.abs(e.absY-t.absY);e.room!==t.room&&(n<=16&&(v[r].points[e.i].x=t.absX-e.offsetX),o<=16&&(v[r].points[e.i].y=t.absY-e.offsetY))}))})),_(Object(s.a)(v))},onDrag:function(e,t){e.preventDefault();var n=Object(s.a)(v);n[r].x+=t.deltaX,n[r].y+=t.deltaY,_(n)}},a.a.createElement("g",{className:"room",id:i.id,transform:"translate(".concat(i.x," ").concat(i.y,")"),onClick:function(){P(i.id)},onKeyDown:function(e){n&&8===e.keyCode&&_((function(e){return e.filter((function(e){return e.id!==i.id}))}))},tabIndex:-1,style:{outline:0}},a.a.createElement(p,{polygon:(t=i.getPoints(),t.map((function(e){return[e.x,e.y].join(" ")})))}),b(i.getPoints()).map((function(e,t){return a.a.createElement(x,{key:t,pathPoints:e,visible:n,segmentIndex:t})})),i.getPoints().map((function(e,t){return a.a.createElement(m,{key:t,point:e,visible:n})})),b(i.getPoints()).map((function(e,t){return a.a.createElement(O,{key:t,pathPoints:e,visible:n})})),i.doors.map((function(e,t){return a.a.createElement(h,{key:t,door:e})}))))};function g(){var e=Object(o.useContext)(l),t=e.__rooms,n=e.__selectedRoom,i=e.__doors,r=Object(c.a)(t,1)[0],s=Object(c.a)(n,1)[0],f=window.innerWidth,b=window.innerHeight;Object(c.a)(i,1)[0];return a.a.createElement("svg",{width:f,height:b},a.a.createElement(u,{width:f,height:b}),r.sort((function(e,t){var n=e.id===s;return n===(t.id===s)?0:n?1:-1})).map((function(e,t){return a.a.createElement(j,{key:e.id,isSelected:s===e.id,room:e,i:t})})))}n(39);var v=n(12),_=n(66),E=n(67);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=function(){var e=Object(o.useContext)(l),t=e.__quickMenuPosition,n=e.__quickMenuState,i=e.__selectedPathPoints,r=e.__rooms,u=e.__selectedRoom,f=e.__pointer,b=e.__doors,p=e.__pathNode,m=Object(c.a)(t,2),y=m[0],x=m[1],O=Object(c.a)(n,2),h=O[0],j=O[1],g=Object(c.a)(i,2),v=g[0],P=(g[1],Object(c.a)(r,2)),w=P[0],X=P[1],Y=Object(c.a)(u,2),C=(Y[0],Y[1],Object(c.a)(f,1)[0]),M=Object(c.a)(b,2),S=(M[0],M[1],Object(c.a)(p,1)[0],function(e){j(!1),x(null)});return a.a.createElement(_.a,{id:"quickMenu",transitionDuration:{enter:0,exit:0},anchorReference:"anchorPosition",anchorPosition:null!==y?{top:y.y,left:y.x}:void 0,open:h,onClose:S},a.a.createElement(E.a,{onClick:function(e){e.persist(),console.log(e);var t=Object(c.a)(v,2),n=t[0],o=(t[1],w.findIndex((function(e){return e.id===n.room}))),a=function(e,t){var n=Object(c.a)(t,2),o=n[0],a=n[1],i=Object(c.a)(e,2),r=i[0],s=i[1];console.log("x",r),console.log("y",s);var l=(a.y-o.y)/(a.x-o.x);console.log("m",l);var u=o.y-l*o.x;return 0===l?s=o.y:isFinite(l)?s=l*r+u:r=o.x,{x:r,y:s}}([C.x-w[o].x,C.y-w[o].y],v);console.log(a),d(w).forEach((function(e){console.log(a),Math.abs(e.absX-(a.x+w[o].x))<16&&(a.x=e.absX-w[o].x),Math.abs(e.absY-(a.y+w[o].y))<16&&(a.y=e.absY-w[o].y)}));var i=k({},a),r=k({},a);w[o].points.splice(n.i+1,0,i,r),X(Object(s.a)(w)),S()}},"new corner"),a.a.createElement(E.a,{onClick:function(e){var t=Object(c.a)(v,2),n=t[0],o=t[1],a=w.findIndex((function(e){return e.id===n.room})),i=C.x-w[a].x,r={pointsIds:{a:n.id,b:o.id},XFromOrigin:i};w[a].doors.push(r),X(Object(s.a)(w)),S()}},"new door"))};var X=function(){var e=Object(o.useState)(null),t=Object(o.useState)(!1),n=Object(o.useState)([]),i={__quickMenuPosition:e,__quickMenuState:t,__selectedRoom:Object(o.useState)(null),__rooms:n,__selectedPathPoints:Object(o.useState)(null),__pointer:Object(o.useState)(null),__doors:Object(o.useState)([]),__pathNode:Object(o.useState)(null)};return a.a.createElement("div",{className:"App",style:{overscrollBehavior:"none"},onContextMenu:function(e){return e.preventDefault()}},a.a.createElement(l.Provider,{value:i},a.a.createElement(g,null),a.a.createElement(w,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[33,1,2]]]);
//# sourceMappingURL=main.9daf3740.chunk.js.map