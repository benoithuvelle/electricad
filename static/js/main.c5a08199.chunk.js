(this.webpackJsonpelectricad=this.webpackJsonpelectricad||[]).push([[0],{33:function(e,t,n){e.exports=n(44)},38:function(e,t,n){},39:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),i=n(3),a=n.n(i),c=(n(38),n(7)),u=n(5);function s(e){var t=e.setSelectedRoom,n=e.setRooms,o=e.rooms,i=e.width,a=e.height;return r.a.createElement("rect",{id:"background",width:i,height:a,fill:"#38a0f9",onDoubleClick:function(e){var r=window.prompt("D\xe9nomination de la pi\xe8ce");if(""!==r&&null!==r)if(o.find((function(e){return e.id===r})))alert("Une pi\xe8ce nomm\xe9e ".concat(r," existe d\xe9j\xe0. Cr\xe9ation annul\xe9e !!!"));else{var i={id:r,coords:[e.clientX-75,e.clientY-75],points:[[0,0],[0,150],[150,150],[150,0]]};n([].concat(Object(u.a)(o),[i])),t(i.id)}},onClick:function(){return t(null)}})}var l=n(12),d=n(17);function f(e){return e.map((function(e){return[e[0],e[1]].join(" ")}))}function p(e){return e.reduce((function(t,n,o){return t[o]=[{XY:n,i:o}],o>0&&t[o-1].push({XY:n,i:o}),o===e.length-1&&t[o].push(t[0][0]),t}),[])}function m(e,t){return e.filter((function(e,n){return n!==t})).reduce((function(e,t,n){return t.points.map((function(n){n.dx=t.coords[0],n.dy=t.coords[1],e.push(n)})),e}),[])}function b(e){return e.points.map((function(t){return t.dx=e.coords[0],t.dy=e.coords[1],t}))}function h(e){return e.reduce((function(e,t,n){var o=b(t);return e.push.apply(e,Object(u.a)(o)),e}),[])}function v(e){e.forEach((function(t,n){var o=m(e,n);p(t.points).forEach((function(e){o.forEach((function(t){console.log(t),function(e,t){var n=Object(c.a)(e,2),o=n[0],r=n[1];console.log(o);var i,a=o.XY[0]+o.XY.dx,u=o.XY[1]+o.XY.dy,s=r.XY[0]+r.XY.dx,l=r.XY[1]+r.XY.dy,d=s-a,f=l-u,p=f/d,m=u-p*a;0===d?(console.log("droite verticale"),i=a-(t[0]+t.dx)):i=0===f?u-(t[1]+t.dy):u-p*a-m;console.log(i),console.log(t[1]+t.dx-p*(t[0]+t.dy)-m),t[1]+t.dx-p*(t[0]+t.dy)-m===i&&console.log("coucou petite peruche")}(e,t)}))}))}))}function y(e){var t=e.polygon;return r.a.createElement("polygon",{points:t,fill:"#ffffaa",stroke:"steelblue"})}var O=function(e){var t=e.coords,n=e.point,o=e.pointIndex,i=e.points,a=e.setPoints,c=e.visible,s=e.rooms;if(!c)return null;var l=n[0],f=n[1];return r.a.createElement(d.DraggableCore,{handle:".corner",onDrag:function(e,t){var n=Object(u.a)(i);n[o]=[l+t.deltaX,f+t.deltaY],a(n)},onStop:function(){var e=Object(u.a)(i);h(s).map((function(r){r!==n&&(Math.abs(n[0]+t[0]-(r[0]+r.dx))<10&&(e[o][0]=r[0]+r.dx-t[0]),Math.abs(n[1]+t[1]-(r[1]+r.dy))<10&&(console.log("match"),e[o][1]=r[1]+r.dy-t[1]))})),a(e)}},r.a.createElement("g",null,r.a.createElement("circle",{className:"corner",cx:l,cy:f,r:16,fill:"white",stroke:"#38a0f9",strokeWidth:4}),r.a.createElement("text",{x:l,y:f,textAnchor:"middle",alignmentBaseline:"central",pointerEvents:"none",fill:"grey"},2)))},g=n(30);function j(e){var t=e.pathPoints,n=e.visible,i=(e.segmentIndex,e.setPoints),a=e.points,s=e.rooms,l=e.setQuickMenuState,f=e.setQuickMenuPosition,p=Object(o.useState)(!1),m=Object(c.a)(p,2),b=m[0],v=m[1],y=Object(c.a)(t,2),O=y[0],j=y[1],k=[O.XY,j.XY],x=Object(c.a)(O.XY,2),E=x[0],M=x[1],X=Object(c.a)(j.XY,2),Y=X[0],P=X[1],S=Object(g.a)().x((function(e){return e[0]})).y((function(e){return e[1]})),w=function(e){console.log(e.type),e.preventDefault(),"mouseup"===e.type?f({x:e.clientX,y:e.clientY}):(f({x:e.touches[0].clientX,y:e.touches[0].clientY}),f({x:30,y:30})),l((function(e){return!e}))};return n?r.a.createElement(d.DraggableCore,{handle:".segment",onDrag:function(e,n){v(!0);var o=Object(u.a)(t);o[0]=[E+n.deltaX,M+n.deltaY],o[1]=[Y+n.deltaX,P+n.deltaY];var r=Object(u.a)(a);r[O.i]=o[0],r[j.i]=o[1],i(Object(u.a)(r))},onStop:function(e,t){if(b){v(!1);var n=h(s),o=Object(u.a)(a);n.map((function(e){Math.abs(e[0]+e.dx-(E+O.XY.dx))<=16&&(o[O.i][0]=e.dx+e[0]-O.XY.dx),Math.abs(e[1]+e.dy-(M+O.XY.dy))<=16&&(o[O.i][1]=e.dy+e[1]-O.XY.dy),Math.abs(e[0]+e.dx-(Y+j.XY.dx))<=16&&(o[j.i][0]=e.dx+e[0]-j.XY.dx),Math.abs(e[1]+e.dy-(P+j.XY.dy))<=16&&(o[j.i][1]=e.dy+e[1]-j.XY.dy),i(Object(u.a)(o))}))}else w(e)}},r.a.createElement("path",{d:S(k),id:O.i+"."+j.i,className:"segment",strokeWidth:20,stroke:"#77cfff",opacity:.8})):null}var k=function(e){var t=e.pathPoints,n=e.visible,o=Object(c.a)(t,2),i=o[0],a=o[1],u=Object(c.a)(i.XY,2),s=u[0],l=u[1],d=Object(c.a)(a.XY,2),f=s-d[0],p=l-d[1],m=Math.round(5*Math.floor(Math.sqrt(f*f+p*p)/5));return n?r.a.createElement("text",{style:{pointerEvents:"none",fill:"#404040"}},r.a.createElement("textPath",{startOffset:"45%",xlinkHref:"#"+i.i+"."+a.i},m)):null};function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M=function(e){var t=e.setRooms,n=e.setSelectedRoom,i=e.isSelected,a=e.roomIndex,s=e.id,l=e.coords,h=e.room,g=e.rooms,x=e.points,M=e.setQuickMenuState,X=e.setQuickMenuPosition,Y=Object(o.useState)(x),P=Object(c.a)(Y,2),S=P[0],w=P[1];Object(o.useEffect)((function(){D(h,a)}),[S]);var D=function(e,n){t((function(t){return[].concat(Object(u.a)(t.slice(0,n)),[E({},e,{points:S})],Object(u.a)(t.slice(n+1)))}))};return r.a.createElement(d.DraggableCore,{handle:".room",cancel:".corner, .segment",disabled:!i,onStop:function(e,t){var n=b(h),o=m(g,a),r=n.map((function(e){return o.map((function(t){var n=e[0]+e.dx,o=t[0]+t.dx;Math.abs(n-o)<=10&&(e[0]=o-e.dx)})),o.map((function(t){var n=e[1]+e.dy,o=t[1]+t.dy;Math.abs(n-o)<=10&&(e[1]=o-e.dy)})),e})),i=E({},h,{points:r});D(i,a),v(g)},onDrag:function(e,t){e.preventDefault(),l[0]+=t.deltaX,l[1]+=t.deltaY,D(h,a)}},r.a.createElement("g",{className:"room",id:s,transform:"translate(".concat(l[0]," ").concat(l[1],")"),onClick:function(){n(s)},onKeyDown:function(e){i&&8===e.keyCode&&t((function(e){return e.filter((function(e){return e.id!==s}))}))},tabIndex:-1,style:{outline:0}},r.a.createElement(y,{polygon:f(S)}),p(S).map((function(e,t){return r.a.createElement(j,{key:t,pathPoints:e,visible:i,segmentIndex:t,setPoints:w,points:S,rooms:g,setQuickMenuState:M,setQuickMenuPosition:X})})),S.map((function(e,t){return r.a.createElement(O,{coords:l,key:t,point:e,pointIndex:t,points:S,setPoints:w,visible:i,rooms:g})})),p(S).map((function(e,t){return r.a.createElement(k,{key:t,pathPoints:e,visible:i})}))))};function X(e){var t=e.setQuickMenuState,n=e.setQuickMenuPosition,i=Object(o.useState)([]),a=Object(c.a)(i,2),u=a[0],l=a[1],d=Object(o.useState)(null),f=Object(c.a)(d,2),p=f[0],m=f[1],b=window.innerWidth,h=window.innerHeight;return r.a.createElement("svg",{width:b,height:h},r.a.createElement(s,{width:b,height:h,setSelectedRoom:m,setRooms:l,rooms:u}),u.sort((function(e,t){var n=e.id===p;return n===(t.id===p)?0:n?1:-1})).map((function(e,o){return r.a.createElement(M,{key:e.id,roomIndex:o,id:e.id,coords:e.coords,isSelected:p===e.id,setSelectedRoom:m,rooms:u,setRooms:l,room:e,points:e.points,setQuickMenuState:t,setQuickMenuPosition:n})})))}n(39);var Y=n(66),P=n(67);var S=function(e){var t=e.quickMenuState,n=e.quickMenuPosition,o=e.setQuickMenuState,i=e.setQuickMenuPosition,a=function(e){o(!1),i(null)};return r.a.createElement(Y.a,{id:"quickMenu",transitionDuration:{enter:0,exit:0},anchorReference:"anchorPosition",anchorPosition:null!==n?{top:n.y,left:n.x}:void 0,open:t,onClose:a},r.a.createElement(P.a,{onClick:a},"Set"),r.a.createElement(P.a,{onClick:a},"Profile"))};var w=function(){var e=Object(o.useState)(null),t=Object(c.a)(e,2),n=t[0],i=t[1],a=Object(o.useState)(!1),u=Object(c.a)(a,2),s=u[0],l=u[1];return r.a.createElement("div",{className:"App",style:{overscrollBehavior:"none"},onContextMenu:function(e){return e.preventDefault()}},r.a.createElement(X,{setQuickMenuState:l,setQuickMenuPosition:i}),r.a.createElement(S,{quickMenuState:s,quickMenuPosition:n,setQuickMenuState:l,setQuickMenuPosition:i}),r.a.createElement("div",{style:{position:"absolute",top:30,left:30}},JSON.stringify(n)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[33,1,2]]]);
//# sourceMappingURL=main.c5a08199.chunk.js.map